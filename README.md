
# Welcome to your CDK Python project!

This is a blank project for CDK development with Python.

The `cdk.json` file tells the CDK Toolkit how to execute your app.

This project is set up like a standard Python project.  The initialization
process also creates a virtualenv within this project, stored under the `.venv`
directory.  To create the virtualenv it assumes that there is a `python3`
(or `python` for Windows) executable in your path with access to the `venv`
package. If for any reason the automatic creation of the virtualenv fails,
you can create the virtualenv manually.

To manually create a virtualenv on MacOS and Linux:

```
$ python3 -m venv .venv
```

After the init process completes and the virtualenv is created, you can use the following
step to activate your virtualenv.

```
$ source .venv/bin/activate
```

If you are a Windows platform, you would activate the virtualenv like this:

```
% .venv\Scripts\activate.bat
```

Once the virtualenv is activated, you can install the required dependencies.

```
$ pip install -r requirements.txt
```

At this point you can now synthesize the CloudFormation template for this code.

```
$ cdk synth
```

To add additional dependencies, for example other CDK libraries, just add
them to your `setup.py` file and rerun the `pip install -r requirements.txt`
command.

## Useful commands

 * `cdk ls`          list all stacks in the app
 * `cdk synth`       emits the synthesized CloudFormation template
 * `cdk deploy`      deploy this stack to your default AWS account/region
 * `cdk diff`        compare deployed stack with current state
 * `cdk docs`        open CDK documentation

Enjoy!

# Daily Report Generation

Reports are automatically generated **daily** to allow subscribers to see which files were uploaded to our system in the last 24 hours.

---

## SNS Topic (Subscription Service)

All subscribers in the SNS topic **`ReportSNS`** will receive the daily report.

* **How to Subscribe:**
    In the deployment stack code, you can enter your email address in the variable **`REPORTSUB`**.
    This will automatically subscribe you to the topic when the stack is deployed.
    You will receive a confirmation email that you **must** approve to activate your subscription.

<img width="806" height="400" alt="SubscriberNotification" src="https://github.com/user-attachments/assets/d54dbbbd-ed01-46ac-9fef-21f123ef5ec8" />


---

## EventBridge (Scheduler)

The EventBridge rule **`ReportSchedule`** is responsible for triggering the report generation every day.

* **Default Schedule:** The report is sent out every day at **11:00 AM UTC**.
* **Customization:** In the stack code, the `ReportSchedule` uses a **cron expression** to determine the time. You can adjust this expression to send the report at a different time.

<img width="806" height="499" alt="ReportURL" src="https://github.com/user-attachments/assets/b93312a2-ae92-4710-b9c5-115d7c3abbae" />


---

## Lambda (Report Generator)

The report is generated by the Lambda function **`ReporterLambda`** and is delivered as a CSV file.

* **Process:**
    1.  The Lambda function compiles a list of files uploaded to the S3 log buckets over the last 24 hours.
    2.  The generated report (CSV file) is uploaded to the S3 Bucket **`ReportBucket`**.
    3.  An email notification is sent out (via SNS) containing a secure link to download the report.

* **Configuration (Environment Variables):** In the stack code for `ReporterLambda`, you can adjust the following environment variables:
    * **`CUTOFF_HOUR`**: Change this value to adjust how far back in time (in hours) the Lambda should look for new filenames (default is 24 hours).
    * **`REPORT_URL_EXPIRATION_SECONDS`**: Change this value to set how long the secure download link in the email remains active before expiring (default is 24 hours).

<img width="612" height="521" alt="Report" src="https://github.com/user-attachments/assets/6bf39f70-54bf-41d1-86c7-6d13db0656bb" />
